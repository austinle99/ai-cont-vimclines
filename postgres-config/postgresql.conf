# PostgreSQL Configuration
# Optimized for High-Performance Workstation
# 256GB RAM, 2x RTX 5080, Windows 11 Pro
# Generated: 2025-11-24

# ===================================================================
# MEMORY CONFIGURATION (Optimized for 256GB RAM)
# ===================================================================

# Shared buffers: ~25% of total RAM for dedicated database server
# For workstation with other apps: ~16GB is safe
shared_buffers = 16GB

# Effective cache size: Estimate of memory available for disk caching
# ~75GB (considering OS uses ~8GB, apps use ~169GB available for cache)
effective_cache_size = 48GB

# Work memory per operation (sorting, hash joins)
# 128MB allows for complex queries without spilling to disk
work_mem = 128MB

# Maintenance operations memory (VACUUM, CREATE INDEX, etc.)
maintenance_work_mem = 2GB

# ===================================================================
# WRITE AHEAD LOG (WAL) CONFIGURATION
# ===================================================================

# WAL buffers: -1 = auto (typically 1/32 of shared_buffers)
wal_buffers = 16MB

# Minimum WAL size to keep
min_wal_size = 2GB

# Maximum WAL size before checkpoint
max_wal_size = 8GB

# Checkpoint completion target (spread checkpoints over time)
checkpoint_completion_target = 0.9

# ===================================================================
# QUERY PLANNER CONFIGURATION
# ===================================================================

# Default statistics target (higher = better estimates, slower ANALYZE)
default_statistics_target = 100

# Random page cost (lower for SSD)
random_page_cost = 1.1

# Effective I/O concurrency (for SSD/NVMe, can be high)
effective_io_concurrency = 200

# ===================================================================
# PARALLEL QUERY CONFIGURATION (Leverage multi-core CPU)
# ===================================================================

# Maximum number of background worker processes
max_worker_processes = 16

# Maximum workers per parallel query
max_parallel_workers_per_gather = 8

# Maximum parallel workers total
max_parallel_workers = 16

# Maximum parallel maintenance workers (for CREATE INDEX, VACUUM)
max_parallel_maintenance_workers = 8

# Enable parallel query for sequential scans
parallel_tuple_cost = 0.01
parallel_setup_cost = 100.0

# ===================================================================
# CONNECTION CONFIGURATION
# ===================================================================

# Maximum number of concurrent connections
max_connections = 200

# Shared memory for locks
max_locks_per_transaction = 64

# ===================================================================
# AUTOVACUUM CONFIGURATION (Important for performance)
# ===================================================================

# Enable autovacuum
autovacuum = on

# Autovacuum worker processes
autovacuum_max_workers = 6

# Autovacuum work memory
autovacuum_work_mem = 1GB

# Naptime between autovacuum runs
autovacuum_naptime = 10s

# Vacuum threshold
autovacuum_vacuum_threshold = 50
autovacuum_vacuum_scale_factor = 0.1

# Analyze threshold
autovacuum_analyze_threshold = 50
autovacuum_analyze_scale_factor = 0.05

# ===================================================================
# LOGGING CONFIGURATION
# ===================================================================

# Log slow queries (queries taking more than 1 second)
log_min_duration_statement = 1000

# Log connections and disconnections
log_connections = off
log_disconnections = off

# Log checkpoints
log_checkpoints = on

# Log lock waits
log_lock_waits = on

# Log temp file usage above 10MB
log_temp_files = 10240

# ===================================================================
# REPLICATION (if needed in future)
# ===================================================================

# WAL level for replication
# wal_level = replica

# Maximum WAL senders
# max_wal_senders = 10

# Maximum replication slots
# max_replication_slots = 10

# ===================================================================
# EXTENSIONS AND MODULES
# ===================================================================

# Preload shared libraries
# shared_preload_libraries = 'pg_stat_statements'

# ===================================================================
# PERFORMANCE TUNING FOR SPECIFIC WORKLOADS
# ===================================================================

# For heavy write workloads
commit_delay = 0
commit_siblings = 5

# Statement timeout (0 = disabled)
statement_timeout = 0

# Lock timeout
lock_timeout = 0

# Idle in transaction timeout
idle_in_transaction_session_timeout = 0

# ===================================================================
# JIT COMPILATION (Just-In-Time compilation for complex queries)
# ===================================================================

# Enable JIT compilation (PostgreSQL 11+)
jit = on
jit_above_cost = 100000
jit_inline_above_cost = 500000
jit_optimize_above_cost = 500000

# ===================================================================
# ADDITIONAL OPTIMIZATIONS
# ===================================================================

# Synchronous commit (off for better performance, but risk of data loss)
# synchronous_commit = off  # ONLY if you can tolerate potential data loss

# Full page writes (keep on for data integrity)
full_page_writes = on

# Timezone
timezone = 'UTC'

# Locale
lc_messages = 'en_US.UTF-8'
lc_monetary = 'en_US.UTF-8'
lc_numeric = 'en_US.UTF-8'
lc_time = 'en_US.UTF-8'

# Default text search config
default_text_search_config = 'pg_catalog.english'
